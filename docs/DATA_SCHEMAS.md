# Data Schemas

All data models in LedgerMind use Pydantic 2.12+ with strict validation.

---

## Core Event Models

### MemoryEvent

Base type for all information flowing into `process_event()`.

```python
class MemoryEvent(BaseModel):
    schema_version: int = 1
    source: Literal["user", "agent", "system", "reflection_engine", "bridge"]
    kind: Literal["decision", "error", "proposal", "commit_change", "task", "call", "prompt", "result"]
    content: str
    context: Union[DecisionContent, ProposalContent, Dict[str, Any]]
    timestamp: datetime
```

---

## Knowledge Content Models

### DecisionContent

Payload for `decision`, `constraint`, and `assumption` events.

```python
class DecisionContent(BaseModel):
    title: str
    target: str
    status: Literal["active", "deprecated", "superseded"] = "active"
    rationale: str
    namespace: str = "default"
    evidence_event_ids: List[int] = []
    consequences: List[str] = []
    supersedes: List[str] = []
    superseded_by: Optional[str] = None
```

---

### ProposalContent

Payload for `proposal` events generated by the reflection engine.

```python
class ProposalContent(BaseModel):
    title: str
    target: str
    status: ProposalStatus = "draft"
    rationale: str
    namespace: str = "default"
    confidence: float
    evidence_event_ids: List[int] = []
    suggested_supersedes: List[str] = []
    procedural: Optional[ProceduralContent] = None
    ready_for_review: bool = False
```

---

### ProceduralContent

Used by MemP (Memory-to-Procedure) distillation.

```python
class ProceduralStep(BaseModel):
    action: str
    rationale: Optional[str] = None
    expected_outcome: Optional[str] = None

class ProceduralContent(BaseModel):
    steps: List[ProceduralStep]
    target_task: str
    success_evidence_ids: List[int]
```

---

## Operation Result Models

### MemoryDecision

Returned by write operations.

```python
class MemoryDecision(BaseModel):
    should_persist: bool
    store_type: Literal["episodic", "semantic", "none"]
    reason: str
    metadata: Dict[str, Any] # Contains 'file_id' or 'event_id'
```

---

## Configuration Model

### LedgermindConfig

```python
class LedgermindConfig(BaseModel):
    storage_path: str = "ledgermind"
    ttl_days: int = 30
    trust_boundary: TrustBoundary = "agent"
    namespace: str = "default"
    vector_model: str = "ledgermind/models/2.7.9-small-text-matching-Q4_K_M.gguf"
    vector_workers: int = 0
    relevance_threshold: float = 0.7
```

---

## MCP Request Models

### RecordDecisionRequest

```python
class RecordDecisionRequest(BaseModel):
    title: str
    target: str
    rationale: str
    namespace: str = "default"
    consequences: List[str] = []
```

### SupersedeDecisionRequest

```python
class SupersedeDecisionRequest(BaseModel):
    title: str
    target: str
    rationale: str
    old_decision_ids: List[str]
    namespace: str = "default"
    consequences: List[str] = []
```
