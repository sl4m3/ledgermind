# Руководство по интеграции LedgerMind

LedgerMind — это автономная система управления знаниями, которая работает как
встраиваемая библиотека или независимый MCP-сервер. В версии 2.6.0 система стала
активной: она берет на себя рутинные задачи по обслуживанию и разрешению
противоречий.

## Встраивание в виде библиотеки

Библиотечный режим идеально подходит для создания сложных автономных агентов,
которым требуется полный контроль над процессом записи и поиска фактов.

### Установка

Установите LedgerMind через `pip`. Мы рекомендуем использовать векторный поиск
для активации функций интеллектуального разрешения конфликтов.

```bash
pip install ledgermind[vector]
```

### Использование IntegrationBridge

Класс `IntegrationBridge` предоставляет высокоуровневый интерфейс «все-в-одном».

```python
from ledgermind.core.api.bridge import IntegrationBridge

# 1. Инициализация
bridge = IntegrationBridge(memory_path="./memory")

# 2. Поиск контекста (Гибридный: векторы + ключевые слова)
context = bridge.get_context_for_prompt("Как настроить CI?")

# 3. Запись взаимодействия
# Эпизодическая память индексируется автоматически
bridge.record_interaction("Настрой CI", "Используй GitHub Actions...")

# 4. Автономное обслуживание
# Если вы используете MCP-сервер, это происходит в фоне автоматически.
# В библиотечном режиме вы можете вызвать это вручную:
bridge.memory.run_maintenance()
```

## Автономные механизмы (v2.6.0+)

### Интеллектуальное разрешение конфликтов
Система больше не требует ручного указания `old_ids` для простых обновлений.
При попытке записать новое решение в занятую цель (`target`):
1.  Система вычисляет вектор контента.
2.  Сравнивает его с текущим активным решением.
3.  Если схожесть > 85%, система автоматически выполняет `supersede`.
4.  Если схожесть низкая, система выдает `ConflictError` с предложением
    альтернативных имен из реестра.

### Канонический реестр целей
LedgerMind автоматически нормализует имена целей и разрешает алиасы. Если вы
записывали данные в `db_config`, а затем обратились к `DATABASE`, реестр
сопоставит эти запросы, предотвращая фрагментацию памяти.

## Интеграция через MCP

Для большинства пользователей работа через MCP является наиболее простым и
мощным способом.

### Запуск сервера

Сервер LedgerMind теперь включает в себя **фоновый воркер (Background Worker)**,
который берет на себя:
- Автоматический импорт коммитов из Git.
- Регулярную рефлексию и создание предложений.
- Очистку устаревших эпизодов.
- Самоисцеление (снятие зависших локов).

```bash
ledgermind-mcp run --path ./.memory
```

## Рекомендации для эксплуатации

1.  **Доверяйте системе**: благодаря авто-замещению, агенты могут просто
    вызывать `record_decision` при изменении своего мнения — система сама
    свяжет события в историю.
2.  **Используйте алиасы**: настройте `targets.json` для маппинга сокращений,
    используемых вашими агентами.
3.  **Мониторинг**: проверяйте `/health` эндпоинт сервера для контроля статуса
    фонового воркера.

